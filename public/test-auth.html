<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Firebase Auth Test</title>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Firebase Authentication Test</h1>
    
    <div id="auth-status">Not authenticated</div>
    <br>
    
    <button onclick="testWithoutAuth()">Test Without Auth</button>
    <button onclick="signInAnonymously()">Sign In Anonymously</button>
    <button onclick="testWithAuth()">Test With Auth</button>
    <button onclick="signOut()">Sign Out</button>
    
    <div id="results"></div>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyCHiS1JxbIm5zclg1QxM-i8DvHPeWMPne0",
            authDomain: "medconnect-2.firebaseapp.com",
            projectId: "medconnect-2",
            storageBucket: "medconnect-2.firebasestorage.app",
            messagingSenderId: "464755135042",
            appId: "1:464755135042:web:ac00e07a1aa0721683d3db",
            measurementId: "G-1Q7MTPV8XE"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Monitor auth state
        auth.onAuthStateChanged(user => {
            const status = document.getElementById('auth-status');
            if (user) {
                status.innerHTML = `✅ Authenticated: ${user.uid}`;
            } else {
                status.innerHTML = '❌ Not authenticated';
            }
        });

        async function testWithoutAuth() {
            const results = document.getElementById('results');
            results.innerHTML = '<h3>Testing without authentication...</h3>';

            try {
                await db.collection('doctors').get();
                results.innerHTML += '<p>❌ SECURITY ISSUE: Can access doctors without auth</p>';
            } catch (error) {
                results.innerHTML += '<p>✅ Good: Doctors blocked - ' + error.code + '</p>';
            }

            try {
                await db.collection('appointments').get();
                results.innerHTML += '<p>❌ SECURITY ISSUE: Can access appointments without auth</p>';
            } catch (error) {
                results.innerHTML += '<p>✅ Good: Appointments blocked - ' + error.code + '</p>';
            }
        }

        async function signInAnonymously() {
            try {
                await auth.signInAnonymously();
                document.getElementById('results').innerHTML = '<p>✅ Signed in anonymously for testing</p>';
            } catch (error) {
                document.getElementById('results').innerHTML = '<p>❌ Error signing in: ' + error.message + '</p>';
            }
        }

        async function testWithAuth() {
            const results = document.getElementById('results');
            results.innerHTML = '<h3>Testing with authentication...</h3>';

            if (!auth.currentUser) {
                results.innerHTML += '<p>❌ Please sign in first</p>';
                return;
            }

            try {
                await db.collection('doctors').get();
                results.innerHTML += '<p>✅ Good: Can access doctors when authenticated</p>';
            } catch (error) {
                results.innerHTML += '<p>❌ Issue: Cannot access doctors - ' + error.code + '</p>';
            }

            try {
                await db.collection('appointments').get();
                results.innerHTML += '<p>ℹ️ Appointments access depends on rules - ' + 'attempted' + '</p>';
            } catch (error) {
                results.innerHTML += '<p>ℹ️ Appointments restricted - ' + error.code + ' (may be expected)</p>';
            }
        }

        async function signOut() {
            await auth.signOut();
            document.getElementById('results').innerHTML = '<p>✅ Signed out</p>';
        }
    </script>
</body>
</html>